!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_inactive",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},t=(e,t,r)=>{document.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)},r=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?n(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},n=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)};function o(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Save",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Saving...";e.textContent=t?n:r}const a=document.querySelectorAll(".modal"),s=document.querySelector(".profile__edit-btn"),l=document.querySelector("#edit-profile-modal"),i=document.querySelectorAll(".modal__close-btn"),c=l.querySelector("#profile-name-input"),d=l.querySelector("#profile-description-input"),u=(l.querySelector(".modal__submit-btn"),document.querySelector(".profile__avatar-btn")),m=document.querySelector(".profile__name"),_=document.querySelector(".profile__description"),h=document.querySelector(".profile__avatar"),v=document.forms["edit-profile"],b=document.querySelector("#card-template"),f=document.querySelector(".cards__list"),y=document.querySelector(".profile__add-btn"),S=document.querySelector("#new-card-modal"),p=S.querySelector("#new-card-link-input"),q=S.querySelector("#new-card-name-input"),k=(S.querySelector(".modal__submit-btn"),document.forms["new-card-form"]),E=document.querySelector("#preview-modal"),L=E.querySelector(".modal__image"),C=E.querySelector(".modal__caption"),g=document.querySelector("#delete-modal"),U=(g.querySelector(".modal__form"),g.querySelector(".modal__submit-btn"),g.querySelector(".modal__submit-btn_cancel")),$=document.querySelector("#avatar-modal"),x=(document.forms["avatar-form"],$.querySelector(".modal__submit-btn"),$.querySelector(".modal__close-btn"),$.querySelector("#modal-avatar-input")),w=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error:${e.status}`)}_request(e,t){return fetch(e,t).then(this._checkResponse)}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return this._request(`${this._baseUrl}/cards`,{headers:this._headers})}getUserInfo(){return this._request(`${this._baseUrl}/users/me`,{headers:this._headers})}editUserInfo(e){let{name:t,about:r}=e;return this._request(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})})}addNewCard(e){let{name:t,link:r}=e;return this._request(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})})}deleteCard(e){return this._request(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers})}avatarSubmit(e){return this._request(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})})}handleLikeCard(e,t){return this._request(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers})}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"9cdeb135-122a-4f81-ae44-c5ef338e99f0","Content-Type":"application/json"}});function A(e){e.classList.add("modal_opened"),document.addEventListener("keydown",N)}function D(e){e.classList.remove("modal_opened"),document.removeEventListener("keydown",N)}let I,T;function N(e){"Escape"===e.key&&D(document.querySelector(".modal_opened"))}function P(e){const t=b.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),n=t.querySelector(".card__delete-btn"),o=t.querySelector(".card__image"),a=t.querySelector(".card__like-btn");return e.isLiked&&a.classList.add("card__like-btn_liked"),r.textContent=e.name,o.src=e.link,o.alt=e.name,a.addEventListener("click",(t=>{!function(e,t){const r=e.target.classList.contains("card__like-btn_liked");w.handleLikeCard(t,r).then((()=>{e.target.classList.toggle("card__like-btn_liked")})).catch((e=>{console.error(e)}))}(t,e._id,e.isLiked)})),n.addEventListener("click",(r=>{!function(e,t){I=e,T=t,A(g)}(t,e._id)})),o.addEventListener("click",(()=>{A(E),C.textContent=e.name,L.src=e.link})),t}var B;w.getAppInfo().then((e=>{let[t,r]=e;t.forEach((e=>{const t=P(e);f.append(t)})),m.textContent=r.name,_.textContent=r.about,h.src=r.avatar})).catch((e=>{console.error(e)})),U.addEventListener("click",(()=>{D(g)})),s.addEventListener("click",(()=>{var r;c.value=m.textContent,d.value=_.textContent,r=e,[c,d].forEach((e=>{t(0,e,r)})),A(l)})),y.addEventListener("click",(()=>{A(S)})),i.forEach((e=>{const t=e.closest(".modal");e.addEventListener("click",(()=>D(t)))})),a.forEach((e=>{e.addEventListener("click",(t=>{t.target===e&&D(e)}))})),u.addEventListener("click",(()=>{A($)})),g.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;o(t,!0,"Delete","Deleting..."),w.deleteCard(T).then((e=>{I.remove(),I="",T="",D(g)})).catch((e=>{console.error(e)})).finally((()=>{o(t,!1,"Delete","Deleting")}))})),$.addEventListener("submit",(function(t){t.preventDefault();const r=t.submitter;o(r,!0),r.disabled=!0,w.avatarSubmit(x.value).then((o=>{h.src=o.avatar,t.target.reset(),n(r,e),D($)})).catch((e=>{console.error(e),r.disabled=!1})).finally((()=>{o(r,!1)}))})),v.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;o(t,!0),w.editUserInfo({name:c.value,about:d.value}).then((e=>{m.textContent=e.name,_.textContent=e.about,D(l)})).catch((e=>{console.error(e)})).finally((()=>{o(t,!1)}))})),k.addEventListener("submit",(function(t){t.preventDefault();const r=t.submitter;o(r,!0),w.addNewCard({name:q.value,link:p.value}).then((o=>{o.link,o.name;const a=P(o);f.prepend(a),D(S),t.target.reset(),n(r,e)})).catch((e=>{console.error(e)})).finally((()=>{o(r,!1)}))})),B=e,Array.from(document.querySelectorAll(B.formSelector)).forEach((e=>{((e,n)=>{const o=Array.from(e.querySelectorAll(n.inputSelector)),a=e.querySelector(n.submitButtonSelector);r(o,a,n),o.forEach((s=>{s.addEventListener("input",(()=>{((e,r,n)=>{r.validity.valid?t(0,r,n):((e,t,r,n)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(n.inputErrorClass)})(e,r,r.validationMessage,n)})(e,s,n),r(o,a,n)}))}))})(e,B)}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoieUJBQU8sTUFBTUEsRUFBVyxDQUN0QkMsYUFBYyxlQUNkQyxjQUFlLGdCQUNmQyxxQkFBc0IscUJBQ3RCQyxvQkFBcUIsNkJBQ3JCQyxnQkFBaUIsMEJBQ2pCQyxXQUFZLHdCQVNSQyxFQUFpQkEsQ0FBQ0MsRUFBVUMsRUFBV0MsS0FDckJDLFNBQVNDLGNBQWMsSUFBSUgsRUFBVUksWUFDN0NDLFlBQWMsR0FDNUJMLEVBQVVNLFVBQVVDLE9BQU9OLEVBQU9MLGdCQUFnQixFQWdCdkNZLEVBQW9CQSxDQUFDQyxFQUFXQyxFQUFZVCxLQUxoQ1EsSUFDaEJBLEVBQVVFLE1BQU1DLElBQ2JBLEVBQU1DLFNBQVNDLFFBSXJCQyxDQUFnQk4sR0FDbEJPLEVBQWNOLEVBQVlULElBRTFCUyxFQUFXTyxVQUFXLEVBQ3RCUCxFQUFXSixVQUFVQyxPQUFPTixFQUFPTixxQkFDckMsRUFHV3FCLEVBQWdCQSxDQUFDTixFQUFZVCxLQUN4Q1MsRUFBV08sVUFBVyxFQUN0QlAsRUFBV0osVUFBVVksSUFBSWpCLEVBQU9OLG9CQUFvQixFQzdDL0MsU0FBU3dCLEVBQ2RDLEVBQ0FDLEdBR0EsSUFGQUMsRUFBV0MsVUFBQUMsT0FBQSxRQUFBQyxJQUFBRixVQUFBLEdBQUFBLFVBQUEsR0FBRyxPQUNkRyxFQUFXSCxVQUFBQyxPQUFBLFFBQUFDLElBQUFGLFVBQUEsR0FBQUEsVUFBQSxHQUFHLFlBR1pILEVBQUlmLFlBREZnQixFQUNnQkssRUFFQUosQ0FFdEIsQ0NzQ0EsTUFBTUssRUFBZ0J6QixTQUFTMEIsaUJBQWlCLFVBQzFDQyxFQUFpQjNCLFNBQVNDLGNBQWMsc0JBQ3hDMkIsRUFBZ0I1QixTQUFTQyxjQUFjLHVCQUN2QzRCLEVBQWU3QixTQUFTMEIsaUJBQWlCLHFCQUN6Q0ksRUFBcUJGLEVBQWMzQixjQUFjLHVCQUNqRDhCLEVBQTRCSCxFQUFjM0IsY0FDOUMsOEJBR0krQixHQURtQkosRUFBYzNCLGNBQWMsc0JBQzVCRCxTQUFTQyxjQUFjLHlCQUMxQ2dDLEVBQWNqQyxTQUFTQyxjQUFjLGtCQUNyQ2lDLEVBQXFCbEMsU0FBU0MsY0FBYyx5QkFDNUNrQyxFQUFnQm5DLFNBQVNDLGNBQWMsb0JBQ3ZDbUMsRUFBZXBDLFNBQVNxQyxNQUFNLGdCQUM5QkMsRUFBZXRDLFNBQVNDLGNBQWMsa0JBQ3RDc0MsRUFBWXZDLFNBQVNDLGNBQWMsZ0JBQ25DdUMsRUFBYXhDLFNBQVNDLGNBQWMscUJBQ3BDd0MsRUFBZXpDLFNBQVNDLGNBQWMsbUJBQ3RDeUMsRUFBZ0JELEVBQWF4QyxjQUFjLHdCQUMzQzBDLEVBQWdCRixFQUFheEMsY0FBYyx3QkFFM0MyQyxHQURnQkgsRUFBYXhDLGNBQWMsc0JBQ3hCRCxTQUFTcUMsTUFBTSxrQkFDbENRLEVBQW1CN0MsU0FBU0MsY0FBYyxrQkFDMUM2QyxFQUFvQkQsRUFBaUI1QyxjQUFjLGlCQUNuRDhDLEVBQXNCRixFQUFpQjVDLGNBQWMsbUJBR3JEK0MsRUFBa0JoRCxTQUFTQyxjQUFjLGlCQUd6Q2dELEdBRmFELEVBQWdCL0MsY0FBYyxnQkFDdEIrQyxFQUFnQi9DLGNBQWMsc0JBQzlCK0MsRUFBZ0IvQyxjQUN6Qyw4QkFLSWlELEVBQXFCbEQsU0FBU0MsY0FBYyxpQkFJNUNrRCxHQUhhbkQsU0FBU3FDLE1BQU0sZUFDVmEsRUFBbUJqRCxjQUFjLHNCQUNsQ2lELEVBQW1CakQsY0FBYyxxQkFDcENpRCxFQUFtQmpELGNBQWMsd0JBRS9DbUQsRUFBTSxJQzNGRyxNQUNiQyxXQUFBQSxDQUFXQyxHQUF1QixJQUF0QixRQUFFQyxFQUFPLFFBQUVDLEdBQVNGLEVBQzlCRyxLQUFLQyxTQUFXSCxFQUNoQkUsS0FBS0UsU0FBV0gsQ0FDbEIsQ0FFQUksY0FBQUEsQ0FBZUMsR0FDYixPQUFJQSxFQUFJQyxHQUNDRCxFQUFJRSxPQUVOQyxRQUFRQyxPQUFPLFNBQVNKLEVBQUlLLFNBQ3JDLENBRUFDLFFBQUFBLENBQVNDLEVBQUtDLEdBQ1osT0FBT0MsTUFBTUYsRUFBS0MsR0FBU0UsS0FBS2QsS0FBS0csZUFDdkMsQ0FFQVksVUFBQUEsR0FDRSxPQUFPUixRQUFRUyxJQUFJLENBQUNoQixLQUFLaUIsa0JBQW1CakIsS0FBS2tCLGVBQ25ELENBRUFELGVBQUFBLEdBQ0UsT0FBT2pCLEtBQUtVLFNBQVMsR0FBR1YsS0FBS0MsaUJBQWtCLENBQzdDRixRQUFTQyxLQUFLRSxVQU1sQixDQUVBZ0IsV0FBQUEsR0FDRSxPQUFPbEIsS0FBS1UsU0FBUyxHQUFHVixLQUFLQyxvQkFBcUIsQ0FDaERGLFFBQVNDLEtBQUtFLFVBTWxCLENBRUFpQixZQUFBQSxDQUFZQyxHQUFrQixJQUFqQixLQUFFQyxFQUFJLE1BQUVDLEdBQU9GLEVBQzFCLE9BQU9wQixLQUFLVSxTQUFTLEdBQUdWLEtBQUtDLG9CQUFxQixDQUNoRHNCLE9BQVEsUUFDUnhCLFFBQVNDLEtBQUtFLFNBQ2RzQixLQUFNQyxLQUFLQyxVQUFVLENBQUVMLE9BQU1DLFdBUWpDLENBRUFLLFVBQUFBLENBQVVDLEdBQWlCLElBQWhCLEtBQUVQLEVBQUksS0FBRVEsR0FBTUQsRUFDdkIsT0FBTzVCLEtBQUtVLFNBQVMsR0FBR1YsS0FBS0MsaUJBQWtCLENBQzdDc0IsT0FBUSxPQUNSeEIsUUFBU0MsS0FBS0UsU0FDZHNCLEtBQU1DLEtBQUtDLFVBQVUsQ0FBRUwsT0FBTVEsVUFRakMsQ0FFQUMsVUFBQUEsQ0FBV3JGLEdBQ1QsT0FBT3VELEtBQUtVLFNBQVMsR0FBR1YsS0FBS0Msa0JBQWtCeEQsSUFBTSxDQUNuRDhFLE9BQVEsU0FDUnhCLFFBQVNDLEtBQUtFLFVBT2xCLENBQ0E2QixZQUFBQSxDQUFhQyxHQUNYLE9BQU9oQyxLQUFLVSxTQUFTLEdBQUdWLEtBQUtDLDJCQUE0QixDQUN2RHNCLE9BQVEsUUFDUnhCLFFBQVNDLEtBQUtFLFNBQ2RzQixLQUFNQyxLQUFLQyxVQUFVLENBQUVNLFlBUTNCLENBQ0FDLGNBQUFBLENBQWV4RixFQUFJeUYsR0FDakIsT0FBT2xDLEtBQUtVLFNBQVMsR0FBR1YsS0FBS0Msa0JBQWtCeEQsVUFBWSxDQUN6RDhFLE9BQVFXLEVBQVUsU0FBVyxNQUM3Qm5DLFFBQVNDLEtBQUtFLFVBT2xCLEdEWmtCLENBQ2xCSixRQUFTLGtEQUNUQyxRQUFTLENBQ1BvQyxjQUFlLHVDQUNmLGVBQWdCLHNCQW9CcEIsU0FBU0MsRUFBVUMsR0FDakJBLEVBQU0xRixVQUFVWSxJQUFJLGdCQUNwQmhCLFNBQVMrRixpQkFBaUIsVUFBV0MsRUFDdkMsQ0FFQSxTQUFTQyxFQUFXSCxHQUNsQkEsRUFBTTFGLFVBQVVDLE9BQU8sZ0JBQ3ZCTCxTQUFTa0csb0JBQW9CLFVBQVdGLEVBQzFDLENBQ0EsSUFBSUcsRUFDQUMsRUErQkosU0FBU0osRUFBZUssR0FDTixXQUFaQSxFQUFJQyxLQUVOTCxFQURrQmpHLFNBQVNDLGNBQWMsaUJBRzdDLENBNkJBLFNBQVNzRyxFQUFlQyxHQUN0QixNQUFNQyxFQUFjbkUsRUFBYW9FLFFBQzlCekcsY0FBYyxTQUNkMEcsV0FBVSxHQUVQQyxFQUFlSCxFQUFZeEcsY0FBYyxnQkFDekM0RyxFQUFnQkosRUFBWXhHLGNBQWMscUJBQzFDNkcsRUFBWUwsRUFBWXhHLGNBQWMsZ0JBQ3RDOEcsRUFBY04sRUFBWXhHLGNBQWMsbUJBbUM5QyxPQWxDSXVHLEVBQUtiLFNBQ1BvQixFQUFZM0csVUFBVVksSUFBSSx3QkFFNUI0RixFQUFhekcsWUFBY3FHLEVBQUsxQixLQUNoQ2dDLEVBQVVFLElBQU1SLEVBQUtsQixLQUNyQndCLEVBQVVHLElBQU1ULEVBQUsxQixLQWNyQmlDLEVBQVloQixpQkFBaUIsU0FBVU0sS0FadkMsU0FBdUJBLEVBQUtuRyxHQUMxQixNQUFNeUYsRUFBVVUsRUFBSWEsT0FBTzlHLFVBQVUrRyxTQUFTLHdCQUM5Qy9ELEVBQ0dzQyxlQUFleEYsRUFBSXlGLEdBQ25CcEIsTUFBSyxLQUNKOEIsRUFBSWEsT0FBTzlHLFVBQVVnSCxPQUFPLHVCQUF1QixJQUVwREMsT0FBT0MsSUFDTkMsUUFBUUMsTUFBTUYsRUFBSSxHQUV4QixDQUdFRyxDQUFjcEIsRUFBS0csRUFBS2tCLElBQUtsQixFQUFLYixRQUFRLElBRzVDa0IsRUFBY2QsaUJBQWlCLFNBQVVNLEtBaEczQyxTQUEwQkksRUFBYWtCLEdBQ3JDeEIsRUFBZU0sRUFDZkwsRUFBaUJ1QixFQUVqQjlCLEVBQVU3QyxFQUNaLENBNEZJNEUsQ0FBaUJuQixFQUFhRCxFQUFLa0IsSUFBSSxJQUd6Q1osRUFBVWYsaUJBQWlCLFNBQVMsS0FDbENGLEVBQVVoRCxHQUVWRSxFQUFvQjVDLFlBQWNxRyxFQUFLMUIsS0FDdkNoQyxFQUFrQmtFLElBQU1SLEVBQUtsQixJQUFJLElBRzVCbUIsQ0FDVCxDRnhLaUMxRyxNRWlDakNxRCxFQUNHb0IsYUFFQUQsTUFBS2pCLElBQXVCLElBQXJCdUUsRUFBT0MsR0FBU3hFLEVBQ3RCdUUsRUFBTUUsU0FBU0MsSUFDYixNQUFNdkIsRUFBY0YsRUFBZXlCLEdBQ25DekYsRUFBVTBGLE9BQU94QixFQUFZLElBRS9CeEUsRUFBWTlCLFlBQWMySCxFQUFTaEQsS0FDbkM1QyxFQUFtQi9CLFlBQWMySCxFQUFTL0MsTUFDMUM1QyxFQUFjNkUsSUFBTWMsRUFBU3JDLE1BQU0sSUFFcEM0QixPQUFPQyxJQUNOQyxRQUFRQyxNQUFNRixFQUFJLElBd0N0QnJFLEVBQW1COEMsaUJBQWlCLFNBQVMsS0FDM0NFLEVBQVdqRCxFQUFnQixJQVM3QnJCLEVBQWVvRSxpQkFBaUIsU0FBUyxLRmxIVm1DLElBQXNCbkksRUVtSG5EK0IsRUFBbUJxRyxNQUFRbEcsRUFBWTlCLFlBQ3ZDNEIsRUFBMEJvRyxNQUFRakcsRUFBbUIvQixZRnBIRkosRUV3SGpEVixFQURBLENBQUN5QyxFQUFvQkMsR0Z0SGJnRyxTQUFTckgsSUFDakJkLEVBQWVDLEVBQVVhLEVBQU9YLEVBQU8sSUV3SHpDOEYsRUFBVWpFLEVBQWMsSUFHMUJZLEVBQVd1RCxpQkFBaUIsU0FBUyxLQUNuQ0YsRUFBVXBELEVBQWEsSUFHekJaLEVBQWFrRyxTQUFTSyxJQUNwQixNQUFNQyxFQUFRRCxFQUFPRSxRQUFRLFVBQzdCRixFQUFPckMsaUJBQWlCLFNBQVMsSUFBTUUsRUFBV29DLElBQU8sSUFHM0Q1RyxFQUFjc0csU0FBU2pDLElBQ3JCQSxFQUFNQyxpQkFBaUIsU0FBVU0sSUFDM0JBLEVBQUlhLFNBQVdwQixHQUNqQkcsRUFBV0gsRUFDYixHQUNBLElBaURKOUQsRUFBaUIrRCxpQkFBaUIsU0FBUyxLQUN6Q0YsRUFBVTNDLEVBQW1CLElBNEUvQkYsRUFBZ0IrQyxpQkFBaUIsVUFwTGpDLFNBQTRCTSxHQUMxQkEsRUFBSWtDLGlCQUNKLE1BQU1DLEVBQXFCbkMsRUFBSW9DLFVBQy9CeEgsRUFBY3VILEdBQW9CLEVBQU0sU0FBVSxlQUNsRHBGLEVBQ0dtQyxXQUFXYSxHQUNYN0IsTUFBTWlDLElBQ0xMLEVBQWE5RixTQUNiOEYsRUFBZSxHQUNmQyxFQUFpQixHQUNqQkgsRUFBV2pELEVBQWdCLElBRTVCcUUsT0FBT0MsSUFDTkMsUUFBUUMsTUFBTUYsRUFBSSxJQUVuQm9CLFNBQVEsS0FDUHpILEVBQWN1SCxHQUFvQixFQUFPLFNBQVUsV0FBVyxHQUVwRSxJQW1LQXRGLEVBQW1CNkMsaUJBQWlCLFVBMUJwQyxTQUE0Qk0sR0FDMUJBLEVBQUlrQyxpQkFFSixNQUFNSSxFQUFrQnRDLEVBQUlvQyxVQUU1QnhILEVBQWMwSCxHQUFpQixHQUMvQkEsRUFBZ0I1SCxVQUFXLEVBRTNCcUMsRUFDR29DLGFBQWFyQyxFQUFZZ0YsT0FDekI1RCxNQUFNaUMsSUFDTHJFLEVBQWM2RSxJQUFNUixFQUFLZixPQUN6QlksRUFBSWEsT0FBTzBCLFFBQ1g5SCxFQUFjNkgsRUFBaUJ0SixHQUMvQjRHLEVBQVcvQyxFQUFtQixJQUUvQm1FLE9BQU9DLElBQ05DLFFBQVFDLE1BQU1GLEdBQ2RxQixFQUFnQjVILFVBQVcsQ0FBSyxJQUVqQzJILFNBQVEsS0FDUHpILEVBQWMwSCxHQUFpQixFQUFNLEdBRTNDLElBS0F2RyxFQUFhMkQsaUJBQWlCLFVBNUU5QixTQUE4Qk0sR0FDNUJBLEVBQUlrQyxpQkFDSixNQUFNTSxFQUFtQnhDLEVBQUlvQyxVQUM3QnhILEVBQWM0SCxHQUFrQixHQUVoQ3pGLEVBQ0d3QixhQUFhLENBQ1pFLEtBQU1oRCxFQUFtQnFHLE1BQ3pCcEQsTUFBT2hELEVBQTBCb0csUUFFbEM1RCxNQUFNdUQsSUFDTDdGLEVBQVk5QixZQUFjMkgsRUFBU2hELEtBQ25DNUMsRUFBbUIvQixZQUFjMkgsRUFBUy9DLE1BQzFDa0IsRUFBV3JFLEVBQWMsSUFFMUJ5RixPQUFPQyxJQUNOQyxRQUFRQyxNQUFNRixFQUFJLElBRW5Cb0IsU0FBUSxLQUNQekgsRUFBYzRILEdBQWtCLEVBQU0sR0FFNUMsSUF3REFqRyxFQUFpQm1ELGlCQUFpQixVQXREbEMsU0FBNkJNLEdBQzNCQSxFQUFJa0MsaUJBQ0osTUFBTU8sRUFBZ0J6QyxFQUFJb0MsVUFFMUJ4SCxFQUFjNkgsR0FBZSxHQUM3QjFGLEVBQ0dnQyxXQUFXLENBQUVOLEtBQU1uQyxFQUFjd0YsTUFBTzdDLEtBQU01QyxFQUFjeUYsUUFDNUQ1RCxNQUFNd0UsSUFFR0EsRUFBU3pELEtBQ1R5RCxFQUFTakUsS0FGakIsTUFJTTJCLEVBQWNGLEVBQWV3QyxHQUNuQ3hHLEVBQVV5RyxRQUFRdkMsR0FDbEJSLEVBQVd4RCxHQUNYNEQsRUFBSWEsT0FBTzBCLFFBQ1g5SCxFQUFjZ0ksRUFBZXpKLEVBQVMsSUFFdkNnSSxPQUFPQyxJQUNOQyxRQUFRQyxNQUFNRixFQUFJLElBRW5Cb0IsU0FBUSxLQUNQekgsRUFBYzZILEdBQWUsRUFBTSxHQUV6QyxJRjdOaUMvSSxFRTRQaEJWLEVGM1BFNEosTUFBTUMsS0FBS2xKLFNBQVMwQixpQkFBaUIzQixFQUFPVCxlQUNwRHlJLFNBQVNsSSxJQWRhc0osRUFBQ3RKLEVBQVVFLEtBQzFDLE1BQU1RLEVBQVkwSSxNQUFNQyxLQUFLckosRUFBUzZCLGlCQUFpQjNCLEVBQU9SLGdCQUN4RDZKLEVBQWdCdkosRUFBU0ksY0FBY0YsRUFBT1Asc0JBQ3BEYyxFQUFrQkMsRUFBVzZJLEVBQWVySixHQUU1Q1EsRUFBVXdILFNBQVNzQixJQUNqQkEsRUFBYXRELGlCQUFpQixTQUFTLEtBdkNoQnVELEVBQUN6SixFQUFVQyxFQUFXQyxLQUMxQ0QsRUFBVWEsU0FBU0MsTUFHdEJoQixFQUFlQyxFQUFVQyxFQUFXQyxHQWhCakJ3SixFQUFDMUosRUFBVUMsRUFBVzBKLEVBQWN6SixLQUNuQ0YsRUFBU0ksY0FBYyxJQUFJSCxFQUFVSSxZQUM3Q0MsWUFBY3FKLEVBQzVCMUosRUFBVU0sVUFBVVksSUFBSWpCLEVBQU9MLGdCQUFnQixFQVc3QzZKLENBQWUxSixFQUFVQyxFQUFXQSxFQUFVMkosa0JBQW1CMUosRUFHbkUsRUFtQ0l1SixDQUFtQnpKLEVBQVV3SixFQUFjdEosR0FDM0NPLEVBQWtCQyxFQUFXNkksRUFBZXJKLEVBQU8sR0FDbkQsR0FDRixFQUtBb0osQ0FBa0J0SixFQUFVRSxFQUFPLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL2hlbHBlcnMuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3Qgc2V0dGluZ3MgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ0blwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zdWJtaXQtYnRuX2luYWN0aXZlXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl92aXNpYmxlXCIsXG59O1xuXG5jb25zdCBzaG93SW5wdXRFcnJvciA9IChmb3JtRWxlbSwgaW5wdXRFbGVtLCBlcnJvck1lc3NhZ2UsIGNvbmZpZykgPT4ge1xuICBjb25zdCBlcnJvck1lc3NFbGVtID0gZm9ybUVsZW0ucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbGVtLmlkfS1lcnJvcmApO1xuICBlcnJvck1lc3NFbGVtLnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xuICBpbnB1dEVsZW0uY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbn07XG5cbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbGVtLCBpbnB1dEVsZW0sIGNvbmZpZykgPT4ge1xuICBjb25zdCBlcnJvck1lc3NFbGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbGVtLmlkfS1lcnJvcmApO1xuICBlcnJvck1lc3NFbGVtLnRleHRDb250ZW50ID0gXCJcIjtcbiAgaW5wdXRFbGVtLmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XG59O1xuXG5jb25zdCBjaGVja0lucHV0VmFsaWRpdHkgPSAoZm9ybUVsZW0sIGlucHV0RWxlbSwgY29uZmlnKSA9PiB7XG4gIGlmICghaW5wdXRFbGVtLnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgc2hvd0lucHV0RXJyb3IoZm9ybUVsZW0sIGlucHV0RWxlbSwgaW5wdXRFbGVtLnZhbGlkYXRpb25NZXNzYWdlLCBjb25maWcpO1xuICB9IGVsc2Uge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtLCBpbnB1dEVsZW0sIGNvbmZpZyk7XG4gIH1cbn07XG5cbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dCkgPT4ge1xuICAgIHJldHVybiAhaW5wdXQudmFsaWRpdHkudmFsaWQ7XG4gIH0pO1xufTtcbmV4cG9ydCBjb25zdCB0b2dnbGVCdXR0b25TdGF0ZSA9IChpbnB1dExpc3QsIGJ1dHRvbkVsZW0sIGNvbmZpZykgPT4ge1xuICBpZiAoaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcbiAgICBkaXNhYmxlQnV0dG9uKGJ1dHRvbkVsZW0sIGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgYnV0dG9uRWxlbS5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIGJ1dHRvbkVsZW0uY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBkaXNhYmxlQnV0dG9uID0gKGJ1dHRvbkVsZW0sIGNvbmZpZykgPT4ge1xuICBidXR0b25FbGVtLmRpc2FibGVkID0gdHJ1ZTtcbiAgYnV0dG9uRWxlbS5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbn07XG5cbmV4cG9ydCBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsZW0sIGlucHV0TGlzdCwgY29uZmlnKSA9PiB7XG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtLCBpbnB1dCwgY29uZmlnKTtcbiAgfSk7XG59O1xuXG5leHBvcnQgY29uc3Qgc2V0RXZlbnRMaXN0ZW5lcnMgPSAoZm9ybUVsZW0sIGNvbmZpZykgPT4ge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbGVtLnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtLnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpO1xuXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWxlbSwgaW5wdXRFbGVtZW50LCBjb25maWcpO1xuICAgICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpO1xuICAgIH0pO1xuICB9KTtcbn07XG5leHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcbiAgY29uc3QgZm9ybUxpc3QgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3RvcikpO1xuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbSkgPT4ge1xuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbGVtLCBjb25maWcpO1xuICB9KTtcbn07XG4vLyBlbmFibGVWYWxpZGF0aW9uKHNldHRpbmdzKTtcbiIsImV4cG9ydCBmdW5jdGlvbiBzZXRCdXR0b25UZXh0KFxuICBidG4sXG4gIGlzTG9hZGluZyxcbiAgZGVmYXVsdFRleHQgPSBcIlNhdmVcIixcbiAgbG9hZGluZ1RleHQgPSBcIlNhdmluZy4uLlwiXG4pIHtcbiAgaWYgKGlzTG9hZGluZykge1xuICAgIGJ0bi50ZXh0Q29udGVudCA9IGxvYWRpbmdUZXh0O1xuICB9IGVsc2Uge1xuICAgIGJ0bi50ZXh0Q29udGVudCA9IGRlZmF1bHRUZXh0O1xuICB9XG59XG4iLCJpbXBvcnQgQXBpIGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcblxuaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCB7XG4gIGVuYWJsZVZhbGlkYXRpb24sXG4gIHNldHRpbmdzLFxuICBzZXRFdmVudExpc3RlbmVycyxcbiAgcmVzZXRWYWxpZGF0aW9uLFxuICBkaXNhYmxlQnV0dG9uLFxufSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XG5pbXBvcnQgeyBzZXRCdXR0b25UZXh0IH0gZnJvbSBcIi4uL3V0aWxzL2hlbHBlcnMuanNcIjtcblxuLy8gY29uc3QgaW5pdGlhbENhcmRzID0gW1xuLy8gICAsXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIlZhbCBUaG9yZW5zXCIsXG4vLyAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzEtcGhvdG8tYnktbW9yaXR6LWZlbGRtYW5uLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIlJlc3RhdXJhbnQgdGVycmFjZVwiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy8yLXBob3RvLWJ5LWNlaWxpbmUtZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIkFuIG91dGRvb3IgY2FmZmVlXCIsXG4vLyAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzMtcGhvdG8tYnktdHViYW51ci1kb2dhbi1mcm9tLXBleGVscy5qcGdcIixcbi8vICAgfSxcblxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJBIHZlcnkgbG9uZyBicmlkZ2UsIG92ZXIgdGhlIGZvcmVzdCBhbmQgdGhyb3VnaCB0aGUgdHJlZXNcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNC1waG90by1ieS1tYXVyaWNlLWxhc2NoZXQtZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG5cbi8vICAge1xuLy8gICAgIG5hbWU6IFwiVHVubmVsIHdpdGggbW9ybmluZyBsaWdodFwiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy81LXBob3RvLWJ5LXZhbi1hbmgtbmd1eWVuLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIk1vdW50YWluIGhvdXNlXCIsXG4vLyAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzYtcGhvdG8tYnktbW9yaXR6LWZlbGRtYW5uLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIkdvbGRlbiBHYXRlIEJyaWRnZVwiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy83LXBob3RvLWJ5LWdyaWZmaW4td29vbGRyaWRnZS1mcm9tLXBleGVscy5qcGdcIixcbi8vICAgfSxcbi8vIF07XG5cbmNvbnN0IG9wZW5Nb2RhbExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnRuXCIpO1xuY29uc3QgZWRpdE1vZGFsUHJvZiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1wcm9maWxlLW1vZGFsXCIpO1xuY29uc3QgY2xvc2VCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xuY29uc3QgZWRpdE1vZGFsSW5wdXROYW1lID0gZWRpdE1vZGFsUHJvZi5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiKTtcbmNvbnN0IGVkaXRNb2RhbElucHV0RGVzY3JpcHRpb24gPSBlZGl0TW9kYWxQcm9mLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxuKTtcbmNvbnN0IGVkaXRNb2RhbFNhdmVCdG4gPSBlZGl0TW9kYWxQcm9mLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XG5jb25zdCBwcm9maWxlQXZhdGFyQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItYnRuXCIpO1xuY29uc3QgcHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xuY29uc3QgcHJvZmlsZUF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xuY29uc3QgZWRpdEZvcm1FbGVtID0gZG9jdW1lbnQuZm9ybXNbXCJlZGl0LXByb2ZpbGVcIl07XG5jb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIik7XG5jb25zdCBjYXJkc0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0XCIpO1xuY29uc3QgbmV3UG9zdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ0blwiKTtcbmNvbnN0IG5ld0NhcmRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LWNhcmQtbW9kYWxcIik7XG5jb25zdCBjYXJkTGlua0lucHV0ID0gbmV3Q2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LWNhcmQtbGluay1pbnB1dFwiKTtcbmNvbnN0IGNhcmROYW1lSW5wdXQgPSBuZXdDYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIiNuZXctY2FyZC1uYW1lLWlucHV0XCIpO1xuY29uc3QgY2FyZFN1Ym1pdEJ0biA9IG5ld0NhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnRuXCIpO1xuY29uc3QgbmV3Q2FyZEZvcm1Nb2RhbCA9IGRvY3VtZW50LmZvcm1zW1wibmV3LWNhcmQtZm9ybVwiXTtcbmNvbnN0IGNhcmRQcmV2aWV3TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ByZXZpZXctbW9kYWxcIik7XG5jb25zdCBwcmV2aWV3TW9kYWxJbWFnZSA9IGNhcmRQcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2VcIik7XG5jb25zdCBwcmV2aWV3TW9kYWxDYXB0aW9uID0gY2FyZFByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xuXG4vLyBEZWxldGUgbW9kYWxcbmNvbnN0IGRlbGV0ZUNhcmRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLW1vZGFsXCIpO1xuY29uc3QgZGVsZXRlRm9ybSA9IGRlbGV0ZUNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgZGVsZXRlQ2FyZE1vZGFsQnRuID0gZGVsZXRlQ2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XG5jb25zdCBjYW5jZWxDYXJkTW9kYWxCdG4gPSBkZWxldGVDYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX3N1Ym1pdC1idG5fY2FuY2VsXCJcbik7XG5cbi8vIEF2YXRhciBtb2RhbFxuXG5jb25zdCBwcm9maWxlQXZhdGFyTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1tb2RhbFwiKTtcbmNvbnN0IGF2YXRhckZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcImF2YXRhci1mb3JtXCJdO1xuY29uc3QgYXZhdGFyU3VibWl0QnRuID0gcHJvZmlsZUF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XG5jb25zdCBhdmF0YXJDbG9zZUJ0biA9IHByb2ZpbGVBdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBhdmF0YXJJbnB1dCA9IHByb2ZpbGVBdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI21vZGFsLWF2YXRhci1pbnB1dFwiKTtcblxuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiOWNkZWIxMzUtMTIyYS00ZjgxLWFlNDQtYzVlZjMzOGU5OWYwXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcblxuYXBpXG4gIC5nZXRBcHBJbmZvKClcblxuICAudGhlbigoW2NhcmRzLCB1c2VyRGF0YV0pID0+IHtcbiAgICBjYXJkcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGl0ZW0pO1xuICAgICAgY2FyZHNMaXN0LmFwcGVuZChjYXJkRWxlbWVudCk7XG4gICAgfSk7XG4gICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB1c2VyRGF0YS5uYW1lO1xuICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IHVzZXJEYXRhLmFib3V0O1xuICAgIHByb2ZpbGVBdmF0YXIuc3JjID0gdXNlckRhdGEuYXZhdGFyO1xuICB9KVxuICAuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgfSk7XG5cbmZ1bmN0aW9uIG9wZW5Nb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVNb2RhbEVzYyk7XG59XG5cbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgaGFuZGxlTW9kYWxFc2MpO1xufVxubGV0IHNlbGVjdGVkQ2FyZDtcbmxldCBzZWxlY3RlZENhcmRJZDtcbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGNhcmRJZCkge1xuICBzZWxlY3RlZENhcmQgPSBjYXJkRWxlbWVudDtcbiAgc2VsZWN0ZWRDYXJkSWQgPSBjYXJkSWQ7XG5cbiAgb3Blbk1vZGFsKGRlbGV0ZUNhcmRNb2RhbCk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IGRlbGV0ZUNhcmRNb2RhbEJ0biA9IGV2dC5zdWJtaXR0ZXI7XG4gIHNldEJ1dHRvblRleHQoZGVsZXRlQ2FyZE1vZGFsQnRuLCB0cnVlLCBcIkRlbGV0ZVwiLCBcIkRlbGV0aW5nLi4uXCIpO1xuICBhcGlcbiAgICAuZGVsZXRlQ2FyZChzZWxlY3RlZENhcmRJZClcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgc2VsZWN0ZWRDYXJkLnJlbW92ZSgpO1xuICAgICAgc2VsZWN0ZWRDYXJkID0gXCJcIjtcbiAgICAgIHNlbGVjdGVkQ2FyZElkID0gXCJcIjtcbiAgICAgIGNsb3NlTW9kYWwoZGVsZXRlQ2FyZE1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzZXRCdXR0b25UZXh0KGRlbGV0ZUNhcmRNb2RhbEJ0biwgZmFsc2UsIFwiRGVsZXRlXCIsIFwiRGVsZXRpbmdcIik7XG4gICAgfSk7XG59XG5jYW5jZWxDYXJkTW9kYWxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChkZWxldGVDYXJkTW9kYWwpO1xufSk7XG5cbmZ1bmN0aW9uIGhhbmRsZU1vZGFsRXNjKGV2dCkge1xuICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgIGNvbnN0IG9wZW5Nb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfb3BlbmVkXCIpO1xuICAgIGNsb3NlTW9kYWwob3Blbk1vZGFsKTtcbiAgfVxufVxuZWRpdFByb2ZpbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgZWRpdE1vZGFsSW5wdXROYW1lLnZhbHVlID0gcHJvZmlsZU5hbWUudGV4dENvbnRlbnQ7XG4gIGVkaXRNb2RhbElucHV0RGVzY3JpcHRpb24udmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQ7XG4gIHJlc2V0VmFsaWRhdGlvbihcbiAgICBlZGl0Rm9ybUVsZW0sXG4gICAgW2VkaXRNb2RhbElucHV0TmFtZSwgZWRpdE1vZGFsSW5wdXREZXNjcmlwdGlvbl0sXG4gICAgc2V0dGluZ3NcbiAgKTtcbiAgb3Blbk1vZGFsKGVkaXRNb2RhbFByb2YpO1xufSk7XG5cbm5ld1Bvc3RCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKG5ld0NhcmRNb2RhbCk7XG59KTtcblxuY2xvc2VCdXR0b25zLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICBjb25zdCBwb3B1cCA9IGJ1dHRvbi5jbG9zZXN0KFwiLm1vZGFsXCIpO1xuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwocG9wdXApKTtcbn0pO1xuXG5vcGVuTW9kYWxMaXN0LmZvckVhY2goKG1vZGFsKSA9PiB7XG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gICAgaWYgKGV2dC50YXJnZXQgPT09IG1vZGFsKSB7XG4gICAgICBjbG9zZU1vZGFsKG1vZGFsKTtcbiAgICB9XG4gIH0pO1xufSk7XG5cbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGRhdGEpIHtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUuY29udGVudFxuICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIilcbiAgICAuY2xvbmVOb2RlKHRydWUpO1xuXG4gIGNvbnN0IGNhcmROYW1lRWxlbSA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XG4gIGNvbnN0IGNhcmREZWxldGVCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idG5cIik7XG4gIGNvbnN0IGNhcmRJbWFnZSA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG4gIGNvbnN0IGNhcmRMaWtlQnRuID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ0blwiKTtcbiAgaWYgKGRhdGEuaXNMaWtlZCkge1xuICAgIGNhcmRMaWtlQnRuLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiKTtcbiAgfVxuICBjYXJkTmFtZUVsZW0udGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gIGNhcmRJbWFnZS5zcmMgPSBkYXRhLmxpbms7XG4gIGNhcmRJbWFnZS5hbHQgPSBkYXRhLm5hbWU7XG5cbiAgZnVuY3Rpb24gaGFuZGxlTGlrZUJ0bihldnQsIGlkKSB7XG4gICAgY29uc3QgaXNMaWtlZCA9IGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiY2FyZF9fbGlrZS1idG5fbGlrZWRcIik7XG4gICAgYXBpXG4gICAgICAuaGFuZGxlTGlrZUNhcmQoaWQsIGlzTGlrZWQpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnRuX2xpa2VkXCIpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgY2FyZExpa2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICBoYW5kbGVMaWtlQnRuKGV2dCwgZGF0YS5faWQsIGRhdGEuaXNMaWtlZCk7XG4gIH0pO1xuXG4gIGNhcmREZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBkYXRhLl9pZCk7XG4gIH0pO1xuXG4gIGNhcmRJbWFnZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIG9wZW5Nb2RhbChjYXJkUHJldmlld01vZGFsKTtcblxuICAgIHByZXZpZXdNb2RhbENhcHRpb24udGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgcHJldmlld01vZGFsSW1hZ2Uuc3JjID0gZGF0YS5saW5rO1xuICB9KTtcblxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XG59XG5cbnByb2ZpbGVBdmF0YXJCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKHByb2ZpbGVBdmF0YXJNb2RhbCk7XG59KTtcblxuZnVuY3Rpb24gaGFuZGxlRWRpdEZvcm1TdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBlZGl0TW9kYWxTYXZlQnRuID0gZXZ0LnN1Ym1pdHRlcjtcbiAgc2V0QnV0dG9uVGV4dChlZGl0TW9kYWxTYXZlQnRuLCB0cnVlKTtcblxuICBhcGlcbiAgICAuZWRpdFVzZXJJbmZvKHtcbiAgICAgIG5hbWU6IGVkaXRNb2RhbElucHV0TmFtZS52YWx1ZSxcbiAgICAgIGFib3V0OiBlZGl0TW9kYWxJbnB1dERlc2NyaXB0aW9uLnZhbHVlLFxuICAgIH0pXG4gICAgLnRoZW4oKHVzZXJEYXRhKSA9PiB7XG4gICAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IHVzZXJEYXRhLm5hbWU7XG4gICAgICBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSB1c2VyRGF0YS5hYm91dDtcbiAgICAgIGNsb3NlTW9kYWwoZWRpdE1vZGFsUHJvZik7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc2V0QnV0dG9uVGV4dChlZGl0TW9kYWxTYXZlQnRuLCBmYWxzZSk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZU5ld0NhcmRTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBjYXJkU3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcblxuICBzZXRCdXR0b25UZXh0KGNhcmRTdWJtaXRCdG4sIHRydWUpO1xuICBhcGlcbiAgICAuYWRkTmV3Q2FyZCh7IG5hbWU6IGNhcmROYW1lSW5wdXQudmFsdWUsIGxpbms6IGNhcmRMaW5rSW5wdXQudmFsdWUgfSlcbiAgICAudGhlbigoY2FyZERhdGEpID0+IHtcbiAgICAgIGNvbnN0IGlucHV0VmFsdWVzID0ge1xuICAgICAgICBsaW5rOiBjYXJkRGF0YS5saW5rLFxuICAgICAgICBuYW1lOiBjYXJkRGF0YS5uYW1lLFxuICAgICAgfTtcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoY2FyZERhdGEpO1xuICAgICAgY2FyZHNMaXN0LnByZXBlbmQoY2FyZEVsZW1lbnQpO1xuICAgICAgY2xvc2VNb2RhbChuZXdDYXJkTW9kYWwpO1xuICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xuICAgICAgZGlzYWJsZUJ1dHRvbihjYXJkU3VibWl0QnRuLCBzZXR0aW5ncyk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc2V0QnV0dG9uVGV4dChjYXJkU3VibWl0QnRuLCBmYWxzZSk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIGNvbnN0IGF2YXRhclN1Ym1pdEJ0biA9IGV2dC5zdWJtaXR0ZXI7XG5cbiAgc2V0QnV0dG9uVGV4dChhdmF0YXJTdWJtaXRCdG4sIHRydWUpO1xuICBhdmF0YXJTdWJtaXRCdG4uZGlzYWJsZWQgPSB0cnVlO1xuXG4gIGFwaVxuICAgIC5hdmF0YXJTdWJtaXQoYXZhdGFySW5wdXQudmFsdWUpXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIHByb2ZpbGVBdmF0YXIuc3JjID0gZGF0YS5hdmF0YXI7XG4gICAgICBldnQudGFyZ2V0LnJlc2V0KCk7XG4gICAgICBkaXNhYmxlQnV0dG9uKGF2YXRhclN1Ym1pdEJ0biwgc2V0dGluZ3MpO1xuICAgICAgY2xvc2VNb2RhbChwcm9maWxlQXZhdGFyTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIGF2YXRhclN1Ym1pdEJ0bi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc2V0QnV0dG9uVGV4dChhdmF0YXJTdWJtaXRCdG4sIGZhbHNlKTtcbiAgICB9KTtcbn1cblxuZGVsZXRlQ2FyZE1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlRGVsZXRlU3VibWl0KTtcbnByb2ZpbGVBdmF0YXJNb2RhbC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUF2YXRhclN1Ym1pdCk7XG5cbmVkaXRGb3JtRWxlbS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUVkaXRGb3JtU3VibWl0KTtcbm5ld0NhcmRGb3JtTW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVOZXdDYXJkU3VibWl0KTtcbmVuYWJsZVZhbGlkYXRpb24oc2V0dGluZ3MpO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiR7cmVzLnN0YXR1c31gKTtcbiAgfVxuXG4gIF9yZXF1ZXN0KHVybCwgb3B0aW9ucykge1xuICAgIHJldHVybiBmZXRjaCh1cmwsIG9wdGlvbnMpLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSwgdGhpcy5nZXRVc2VySW5mbygpXSk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pO1xuXG4gICAgLy8gcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgIC8vICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAvLyB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pO1xuXG4gICAgLy8gcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgIC8vICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAvLyB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZWRpdFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lLCBhYm91dCB9KSxcbiAgICB9KTtcblxuICAgIC8vIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAvLyAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgIC8vICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAvLyAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgYWJvdXQgfSksXG4gICAgLy8gfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGFkZE5ld0NhcmQoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lLCBsaW5rIH0pLFxuICAgIH0pO1xuXG4gICAgLy8gcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgIC8vICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAvLyAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgLy8gICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IG5hbWUsIGxpbmsgfSksXG4gICAgLy8gfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoaWQpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSk7XG5cbiAgICAvLyByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XG4gICAgLy8gICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgLy8gICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIC8vIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cbiAgYXZhdGFyU3VibWl0KGF2YXRhcikge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYXZhdGFyIH0pLFxuICAgIH0pO1xuXG4gICAgLy8gcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICAvLyAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgIC8vICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAvLyAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYXZhdGFyIH0pLFxuICAgIC8vIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cbiAgaGFuZGxlTGlrZUNhcmQoaWQsIGlzTGlrZWQpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogaXNMaWtlZCA/IFwiREVMRVRFXCIgOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KTtcblxuICAgIC8vIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfS9saWtlc2AsIHtcbiAgICAvLyAgIG1ldGhvZDogaXNMaWtlZCA/IFwiREVMRVRFXCIgOiBcIlBVVFwiLFxuICAgIC8vICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAvLyB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG59XG4iXSwibmFtZXMiOlsic2V0dGluZ3MiLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsZW0iLCJpbnB1dEVsZW0iLCJjb25maWciLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsInRleHRDb250ZW50IiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbGVtIiwic29tZSIsImlucHV0IiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVCdXR0b24iLCJkaXNhYmxlZCIsImFkZCIsInNldEJ1dHRvblRleHQiLCJidG4iLCJpc0xvYWRpbmciLCJkZWZhdWx0VGV4dCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImxvYWRpbmdUZXh0Iiwib3Blbk1vZGFsTGlzdCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJlZGl0UHJvZmlsZUJ0biIsImVkaXRNb2RhbFByb2YiLCJjbG9zZUJ1dHRvbnMiLCJlZGl0TW9kYWxJbnB1dE5hbWUiLCJlZGl0TW9kYWxJbnB1dERlc2NyaXB0aW9uIiwicHJvZmlsZUF2YXRhckJ0biIsInByb2ZpbGVOYW1lIiwicHJvZmlsZURlc2NyaXB0aW9uIiwicHJvZmlsZUF2YXRhciIsImVkaXRGb3JtRWxlbSIsImZvcm1zIiwiY2FyZFRlbXBsYXRlIiwiY2FyZHNMaXN0IiwibmV3UG9zdEJ0biIsIm5ld0NhcmRNb2RhbCIsImNhcmRMaW5rSW5wdXQiLCJjYXJkTmFtZUlucHV0IiwibmV3Q2FyZEZvcm1Nb2RhbCIsImNhcmRQcmV2aWV3TW9kYWwiLCJwcmV2aWV3TW9kYWxJbWFnZSIsInByZXZpZXdNb2RhbENhcHRpb24iLCJkZWxldGVDYXJkTW9kYWwiLCJjYW5jZWxDYXJkTW9kYWxCdG4iLCJwcm9maWxlQXZhdGFyTW9kYWwiLCJhdmF0YXJJbnB1dCIsImFwaSIsImNvbnN0cnVjdG9yIiwiX3JlZiIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJfY2hlY2tSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJfcmVxdWVzdCIsInVybCIsIm9wdGlvbnMiLCJmZXRjaCIsInRoZW4iLCJnZXRBcHBJbmZvIiwiYWxsIiwiZ2V0SW5pdGlhbENhcmRzIiwiZ2V0VXNlckluZm8iLCJlZGl0VXNlckluZm8iLCJfcmVmMiIsIm5hbWUiLCJhYm91dCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiYWRkTmV3Q2FyZCIsIl9yZWYzIiwibGluayIsImRlbGV0ZUNhcmQiLCJhdmF0YXJTdWJtaXQiLCJhdmF0YXIiLCJoYW5kbGVMaWtlQ2FyZCIsImlzTGlrZWQiLCJhdXRob3JpemF0aW9uIiwib3Blbk1vZGFsIiwibW9kYWwiLCJhZGRFdmVudExpc3RlbmVyIiwiaGFuZGxlTW9kYWxFc2MiLCJjbG9zZU1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInNlbGVjdGVkQ2FyZCIsInNlbGVjdGVkQ2FyZElkIiwiZXZ0Iiwia2V5IiwiZ2V0Q2FyZEVsZW1lbnQiLCJkYXRhIiwiY2FyZEVsZW1lbnQiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiY2FyZE5hbWVFbGVtIiwiY2FyZERlbGV0ZUJ0biIsImNhcmRJbWFnZSIsImNhcmRMaWtlQnRuIiwic3JjIiwiYWx0IiwidGFyZ2V0IiwiY29udGFpbnMiLCJ0b2dnbGUiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsImhhbmRsZUxpa2VCdG4iLCJfaWQiLCJjYXJkSWQiLCJoYW5kbGVEZWxldGVDYXJkIiwiY2FyZHMiLCJ1c2VyRGF0YSIsImZvckVhY2giLCJpdGVtIiwiYXBwZW5kIiwicmVzZXRWYWxpZGF0aW9uIiwidmFsdWUiLCJidXR0b24iLCJwb3B1cCIsImNsb3Nlc3QiLCJwcmV2ZW50RGVmYXVsdCIsImRlbGV0ZUNhcmRNb2RhbEJ0biIsInN1Ym1pdHRlciIsImZpbmFsbHkiLCJhdmF0YXJTdWJtaXRCdG4iLCJyZXNldCIsImVkaXRNb2RhbFNhdmVCdG4iLCJjYXJkU3VibWl0QnRuIiwiY2FyZERhdGEiLCJwcmVwZW5kIiwiQXJyYXkiLCJmcm9tIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJidXR0b25FbGVtZW50IiwiaW5wdXRFbGVtZW50IiwiY2hlY2tJbnB1dFZhbGlkaXR5Iiwic2hvd0lucHV0RXJyb3IiLCJlcnJvck1lc3NhZ2UiLCJ2YWxpZGF0aW9uTWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=